<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" id="Definitions_1u5bw24" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.3.0">
  <bpmn:process id="Payment" name="Payment Process" isExecutable="true">
    <bpmn:sequenceFlow id="Flow_129q7bt" sourceRef="PaymentProcess_StartEvent" targetRef="DeductCredit_ServiceTask" />
    <bpmn:sequenceFlow id="Flow_0mbktow" sourceRef="DeductCredit_ServiceTask" targetRef="Gateway_17xq6h9" />
    <bpmn:sequenceFlow id="Flow_0try2on" sourceRef="ChargeCredit_ServiceTask" targetRef="Gateway_0cer1ie" />
    <bpmn:exclusiveGateway id="Gateway_17xq6h9" name="Credit sufficient?">
      <bpmn:incoming>Flow_0mbktow</bpmn:incoming>
      <bpmn:outgoing>Flow_1s04528</bpmn:outgoing>
      <bpmn:outgoing>Flow_181p7up</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1s04528" name="No" sourceRef="Gateway_17xq6h9" targetRef="ChargeCredit_ServiceTask">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${not creditSufficient}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:exclusiveGateway id="Gateway_0cer1ie">
      <bpmn:incoming>Flow_0try2on</bpmn:incoming>
      <bpmn:incoming>Flow_181p7up</bpmn:incoming>
      <bpmn:outgoing>Flow_0hs8ygc</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0hs8ygc" sourceRef="Gateway_0cer1ie" targetRef="PaymentProcess_EndEvent" />
    <bpmn:sequenceFlow id="Flow_181p7up" name="Yes" sourceRef="Gateway_17xq6h9" targetRef="Gateway_0cer1ie">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${creditSufficient}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:serviceTask id="DeductCredit_ServiceTask" name="Deduct credit" camunda:type="external" camunda:topic="creditDeducting">
      <bpmn:incoming>Flow_129q7bt</bpmn:incoming>
      <bpmn:outgoing>Flow_0mbktow</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="ChargeCredit_ServiceTask" name="Charge credit card" camunda:type="external" camunda:topic="chargeCredit">
      <bpmn:incoming>Flow_1s04528</bpmn:incoming>
      <bpmn:outgoing>Flow_0try2on</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:boundaryEvent id="Event_0tuq3jd" name="Charge Credit Error" attachedToRef="ChargeCredit_ServiceTask">
      <bpmn:outgoing>Flow_14l1iae</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_067148k" errorRef="Error_0evih5s" />
    </bpmn:boundaryEvent>
    <bpmn:boundaryEvent id="Event_0nus3zx" name="Compensate deduction" attachedToRef="DeductCredit_ServiceTask">
      <bpmn:compensateEventDefinition id="CompensateEventDefinition_1t9cxex" />
    </bpmn:boundaryEvent>
    <bpmn:endEvent id="PaymentFailed_CompensationEndEvent" name="Payment failed">
      <bpmn:incoming>Flow_196kxj7</bpmn:incoming>
      <bpmn:compensateEventDefinition id="CompensateEventDefinition_0udih5k" activityRef="DeductCredit_ServiceTask" />
    </bpmn:endEvent>
    <bpmn:userTask id="ReviewChanges_UserTask" name="Manually resolve issue" camunda:formKey="embedded:deployment:task-form.html" camunda:candidateGroups="account">
      <bpmn:incoming>Flow_0nyxnxo</bpmn:incoming>
      <bpmn:outgoing>Flow_0ajzy38</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="CompensateAccountBalance_ServiceTask" name="Compensate account balance" isForCompensation="true" camunda:type="external" camunda:topic="compensateDeduction" />
    <bpmn:startEvent id="PaymentProcess_StartEvent" name="Payment requested">
      <bpmn:outgoing>Flow_129q7bt</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1vrkrsc" messageRef="Message_0uzl2hb" />
    </bpmn:startEvent>
    <bpmn:exclusiveGateway id="Gateway_1f56e56" name="Resolveable?">
      <bpmn:incoming>Flow_14l1iae</bpmn:incoming>
      <bpmn:outgoing>Flow_196kxj7</bpmn:outgoing>
      <bpmn:outgoing>Flow_0nyxnxo</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_196kxj7" name="no" sourceRef="Gateway_1f56e56" targetRef="PaymentFailed_CompensationEndEvent">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!resolvable}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="PaymentManuallyResolved_EndEvent" name="Payment manually resolved">
      <bpmn:incoming>Flow_0ajzy38</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_0nyxnxo" name="yes" sourceRef="Gateway_1f56e56" targetRef="ReviewChanges_UserTask">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${resolvable}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0ajzy38" sourceRef="ReviewChanges_UserTask" targetRef="PaymentManuallyResolved_EndEvent" />
    <bpmn:sequenceFlow id="Flow_14l1iae" sourceRef="Event_0tuq3jd" targetRef="Gateway_1f56e56" />
    <bpmn:endEvent id="PaymentProcess_EndEvent" name="Payment processed">
      <bpmn:incoming>Flow_0hs8ygc</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1gu1yfs" camunda:type="external" camunda:topic="payment-complete" />
    </bpmn:endEvent>
    <bpmn:association id="Association_18td4vt" associationDirection="One" sourceRef="Event_0nus3zx" targetRef="CompensateAccountBalance_ServiceTask" />
  </bpmn:process>
  <bpmn:error id="Error_0evih5s" name="ErrorCreditCardChargeFailed" errorCode="CreditCardFailure" />
  <bpmn:escalation id="Escalation_187fqbu" name="Escalation_0q60cod" />
  <bpmn:message id="Message_0uzl2hb" name="payment-message" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Payment">
      <bpmndi:BPMNEdge id="Flow_14l1iae_di" bpmnElement="Flow_14l1iae">
        <di:waypoint x="580" y="255" />
        <di:waypoint x="580" y="305" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ajzy38_di" bpmnElement="Flow_0ajzy38">
        <di:waypoint x="809" y="450" />
        <di:waypoint x="982" y="450" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nyxnxo_di" bpmnElement="Flow_0nyxnxo">
        <di:waypoint x="580" y="355" />
        <di:waypoint x="580" y="450" />
        <di:waypoint x="709" y="450" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="651" y="434" width="17" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_196kxj7_di" bpmnElement="Flow_196kxj7">
        <di:waypoint x="605" y="330" />
        <di:waypoint x="982" y="330" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="661" y="312" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_181p7up_di" bpmnElement="Flow_181p7up">
        <di:waypoint x="446" y="172" />
        <di:waypoint x="446" y="100" />
        <di:waypoint x="759" y="100" />
        <di:waypoint x="759" y="172" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="489" y="82" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hs8ygc_di" bpmnElement="Flow_0hs8ygc">
        <di:waypoint x="784" y="197" />
        <di:waypoint x="982" y="197" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1s04528_di" bpmnElement="Flow_1s04528">
        <di:waypoint x="471" y="197" />
        <di:waypoint x="540" y="197" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="490" y="179" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0try2on_di" bpmnElement="Flow_0try2on">
        <di:waypoint x="640" y="197" />
        <di:waypoint x="734" y="197" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0mbktow_di" bpmnElement="Flow_0mbktow">
        <di:waypoint x="352" y="197" />
        <di:waypoint x="421" y="197" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_129q7bt_di" bpmnElement="Flow_129q7bt">
        <di:waypoint x="188" y="197" />
        <di:waypoint x="252" y="197" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Gateway_17xq6h9_di" bpmnElement="Gateway_17xq6h9" isMarkerVisible="true">
        <dc:Bounds x="421" y="172" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="405" y="232" width="82" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0cer1ie_di" bpmnElement="Gateway_0cer1ie" isMarkerVisible="true">
        <dc:Bounds x="734" y="172" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0gwyk36_di" bpmnElement="DeductCredit_ServiceTask">
        <dc:Bounds x="252" y="157" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0zzq5ny_di" bpmnElement="ChargeCredit_ServiceTask">
        <dc:Bounds x="540" y="157" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0gi8i3n_di" bpmnElement="PaymentFailed_CompensationEndEvent">
        <dc:Bounds x="982" y="312" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="963" y="358" width="73" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0mpzfkm_di" bpmnElement="ReviewChanges_UserTask">
        <dc:Bounds x="709" y="410" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_00hlucg_di" bpmnElement="CompensateAccountBalance_ServiceTask">
        <dc:Bounds x="252" y="300" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0is3b37_di" bpmnElement="PaymentProcess_StartEvent">
        <dc:Bounds x="152" y="179" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="146" y="222" width="49" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1f56e56_di" bpmnElement="Gateway_1f56e56" isMarkerVisible="true">
        <dc:Bounds x="555" y="305" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="478" y="323" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_17yaxf0_di" bpmnElement="PaymentManuallyResolved_EndEvent">
        <dc:Bounds x="982" y="432" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="955" y="475" width="89" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_08pw5ui_di" bpmnElement="PaymentProcess_EndEvent">
        <dc:Bounds x="982" y="179" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="975" y="222" width="51" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0fy08us_di" bpmnElement="Event_0nus3zx">
        <dc:Bounds x="284" y="219" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="230" y="262" width="63" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0zkf0es_di" bpmnElement="Event_0tuq3jd">
        <dc:Bounds x="562" y="219" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="585" y="262" width="70" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_18td4vt_di" bpmnElement="Association_18td4vt">
        <di:waypoint x="302" y="255" />
        <di:waypoint x="302" y="300" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
